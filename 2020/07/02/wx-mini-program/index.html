<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://vicyor.gitee.io').hostname,
    root: '/',
    scheme: 'Gemini',
    version: '7.6.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="干货!干货!干货!">
<meta property="og:type" content="article">
<meta property="og:title" content="wx-mini-program">
<meta property="og:url" content="http://vicyor.gitee.io/2020/07/02/wx-mini-program/index.html">
<meta property="og:site_name" content="Vicyor">
<meta property="og:description" content="干货!干货!干货!">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://vicyor.gitee.io/2020/07/02/wx-mini-program/page-lifecycle.png">
<meta property="article:published_time" content="2020-07-02T06:41:17.000Z">
<meta property="article:modified_time" content="2020-07-11T01:00:39.235Z">
<meta property="article:author" content="vicyor">
<meta property="article:tag" content="mini-program">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://vicyor.gitee.io/2020/07/02/wx-mini-program/page-lifecycle.png">

<link rel="canonical" href="http://vicyor.gitee.io/2020/07/02/wx-mini-program/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>wx-mini-program | Vicyor</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Vicyor</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签<span class="badge">49</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档<span class="badge">55</span></a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://vicyor.gitee.io/2020/07/02/wx-mini-program/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="vicyor">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vicyor">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          wx-mini-program
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-02 14:41:17" itemprop="dateCreated datePublished" datetime="2020-07-02T14:41:17+08:00">2020-07-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-11 09:00:39" itemprop="dateModified" datetime="2020-07-11T09:00:39+08:00">2020-07-11</time>
              </span>

          
            <span id="/2020/07/02/wx-mini-program/" class="post-meta-item leancloud_visitors" data-flag-title="wx-mini-program" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2020/07/02/wx-mini-program/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/07/02/wx-mini-program/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>30k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>27 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>干货!干货!干货!</p>
<a id="more"></a>
<h2 id="起步"><a href="#起步" class="headerlink" title="起步"></a>起步</h2><h3 id="代码构成"><a href="#代码构成" class="headerlink" title="代码构成"></a>代码构成</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.json  -&gt;  配置文件</span><br><span class="line">.wxml  -&gt;  模板文件</span><br><span class="line">.wxss  -&gt;  样式文件</span><br><span class="line">.js    -&gt;  脚本文件</span><br></pre></td></tr></table></figure>
<h3 id="json"><a href="#json" class="headerlink" title="json"></a>json</h3><h4 id="app-json"><a href="#app-json" class="headerlink" title="app.json"></a>app.json</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.json -&gt; 全局配置文件 -&gt; 页面路径、界面表现、网络超时时间、底部tab等.</span><br><span class="line">    pages -&gt; 小程序的页面路径</span><br><span class="line">    window -&gt; 页面的顶部背景颜色,文字颜色.</span><br></pre></td></tr></table></figure>
<h4 id="project-config-json"><a href="#project-config-json" class="headerlink" title="project.config.json"></a>project.config.json</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">开发者工具(微信开发工具)的个性化配置.</span><br></pre></td></tr></table></figure>
<h3 id="WXML模板"><a href="#WXML模板" class="headerlink" title="WXML模板"></a>WXML模板</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.WXML -&gt; html</span><br><span class="line">2.标签 -&gt; 组件 -&gt; view,button,text等.</span><br><span class="line">3.属性:wx:if、&#123;&#123;&#125;&#125;等.</span><br><span class="line">  &#123;&#123;&#125;&#125; -&gt; mvvm -&gt; 数据绑定，变化自动渲染.</span><br></pre></td></tr></table></figure>
<h3 id="WXSS样式"><a href="#WXSS样式" class="headerlink" title="WXSS样式"></a>WXSS样式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.新的尺寸单位  -&gt;  rpx  -&gt;  根据手机屏幕大小自动调整与px的比例.</span><br><span class="line">2.wxss支持css选择器.</span><br></pre></td></tr></table></figure>
<h4 id="app-wxss"><a href="#app-wxss" class="headerlink" title="app.wxss"></a>app.wxss</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">项目全局样式</span><br></pre></td></tr></table></figure>
<h3 id="JS逻辑交互"><a href="#JS逻辑交互" class="headerlink" title="JS逻辑交互"></a>JS逻辑交互</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1.一个简单的小例子.</span><br><span class="line">   &lt;view&gt;&#123;&#123;msg&#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">   &lt;button bindtap&#x3D;&quot;clickMe&quot;&gt;点击我&lt;&#x2F;button&gt;</span><br><span class="line"> -&gt;</span><br><span class="line">   Page(&#123;</span><br><span class="line">       clickMe: function()&#123;</span><br><span class="line">           this.setData(&#123;msg: &#39;Hello World!&#39;&#125;);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;)</span><br></pre></td></tr></table></figure>
<h3 id="小程序宿主环境"><a href="#小程序宿主环境" class="headerlink" title="小程序宿主环境"></a>小程序宿主环境</h3><h4 id="渲染层与逻辑层"><a href="#渲染层与逻辑层" class="headerlink" title="渲染层与逻辑层"></a>渲染层与逻辑层</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.渲染层  -&gt;  WXML + WXSS.</span><br><span class="line">  逻辑层  -&gt;  JS脚本.</span><br><span class="line">2.渲染层与逻辑层使用二个线程管理.</span><br><span class="line">    渲染层的界面使用WebView进行渲染.</span><br><span class="line">    逻辑层采用JsCore线程运行JS脚本.</span><br></pre></td></tr></table></figure>
<h2 id="配置小程序"><a href="#配置小程序" class="headerlink" title="配置小程序"></a>配置小程序</h2><h3 id="全局配置"><a href="#全局配置" class="headerlink" title="全局配置"></a>全局配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">1.app.json.</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;pages&quot;: [</span><br><span class="line">        &quot;pages&#x2F;index&#x2F;index&quot;,</span><br><span class="line">        &quot;pages&#x2F;logs&#x2F;index&quot;</span><br><span class="line">      ],</span><br><span class="line">      &quot;window&quot;: &#123;</span><br><span class="line">          &quot;navigationBarBackgroundColor&quot;: &quot;#ffffff&quot;,</span><br><span class="line">          &quot;navigationBarTextStyle&quot;: &quot;black&quot;,</span><br><span class="line">          &quot;navigationBarTitleText&quot;: &quot;微信接口功能演示&quot;,</span><br><span class="line">          &quot;backgroundColor&quot;: &quot;#eeeeee&quot;,</span><br><span class="line">          &quot;backgroundTextStyle&quot;: &quot;light&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">      &quot;tabBar&quot;: &#123;</span><br><span class="line">        &quot;list&quot;: [&#123;</span><br><span class="line">          &quot;pagePath&quot;: &quot;pages&#x2F;index&#x2F;index&quot;,</span><br><span class="line">          &quot;text&quot;: &quot;首页&quot;</span><br><span class="line">        &#125;, &#123;</span><br><span class="line">          &quot;pagePath&quot;: &quot;pages&#x2F;logs&#x2F;index&quot;,</span><br><span class="line">          &quot;text&quot;: &quot;日志&quot;</span><br><span class="line">        &#125;]</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;networkTimeout&quot;: &#123;</span><br><span class="line">        &quot;request&quot;: 10000,</span><br><span class="line">        &quot;downloadFile&quot;: 10000</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;debug&quot;: true,</span><br><span class="line">      &quot;navigateToMiniProgramAppIdList&quot;: [</span><br><span class="line">        &quot;wxe5f52902cf4de896&quot;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="sitemap配置"><a href="#sitemap配置" class="headerlink" title="sitemap配置"></a>sitemap配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1.小程序根目录下的 sitemap.json 文件用来配置小程序及其页面是否允许被微信索引.</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;rules&quot;:[&#123;</span><br><span class="line">        &quot;action&quot;: &quot;allow&quot;,</span><br><span class="line">        &quot;page&quot;: &quot;*&quot;,</span><br><span class="line">        &quot;params&quot;:[&#39;name&#39;,&#39;age&#39;]</span><br><span class="line">      &#125;]</span><br><span class="line">    &#125;</span><br><span class="line">    action -&gt; allow&#x2F;disallow</span><br><span class="line">2.若rule中有param,请求的url中不带param,则该规则不匹配.</span><br><span class="line">3.rule中靠前的rule优先级高.</span><br></pre></td></tr></table></figure>
<h2 id="小程序框架"><a href="#小程序框架" class="headerlink" title="小程序框架"></a>小程序框架</h2><h3 id="场景值"><a href="#场景值" class="headerlink" title="场景值"></a>场景值</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1.场景值  -  描述用户进入小程序的路径.</span><br><span class="line">  小程序  -  onLauch&#x2F;onShow&#x2F;wx.getlauchOptionSync获取上速场景值.</span><br><span class="line">2.场景值.</span><br><span class="line">020	    公众号 profile 页相关小程序列表	    来源公众号</span><br><span class="line">1035	公众号自定义菜单	                来源公众号</span><br><span class="line">1036	App 分享消息卡片	                来源App</span><br><span class="line">1037	小程序打开小程序	                来源小程序</span><br><span class="line">1038	从另一个小程序返回	            来源小程序</span><br><span class="line">1043	公众号模板消息	                来源公众号</span><br></pre></td></tr></table></figure>
<h3 id="逻辑层-App-Service"><a href="#逻辑层-App-Service" class="headerlink" title="逻辑层 App Service"></a>逻辑层 App Service</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1.逻辑层提供JavaScript以及微信小程序的特有功能.</span><br><span class="line">2.逻辑层将数据处理后发送给视图层,同时接收视图层的事件反馈.</span><br><span class="line">3.App Service -&gt;  开发者写的所有代码最终会打包成一份javascript文件,并在小程序启动时候运行,直到小程序销毁.</span><br><span class="line">4.在js基础上,添加的功能.</span><br><span class="line">    1.增加App和Page方法,进行程序注册和页面注册.</span><br><span class="line">    2.getApp&#x2F;getCurrentPage用来获取App实例和当前页面栈.</span><br><span class="line">    3.提供丰富的API,如微信用户数据,扫一扫,支付等微信.</span><br><span class="line">    4.提供模块化能力,每个页面都有独立的作用域.</span><br><span class="line">5.web中的逻辑对象如window与document无法使用.</span><br></pre></td></tr></table></figure>
<h4 id="注册小程序"><a href="#注册小程序" class="headerlink" title="注册小程序"></a>注册小程序</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">1.app.js</span><br><span class="line">    App(&#123;</span><br><span class="line">      onLaunch (options) &#123;</span><br><span class="line">        &#x2F;&#x2F; Do something initial when launch.</span><br><span class="line">      &#125;,</span><br><span class="line">      onShow (options) &#123;</span><br><span class="line">        &#x2F;&#x2F; Do something when show.</span><br><span class="line">      &#125;,</span><br><span class="line">      onHide () &#123;</span><br><span class="line">        &#x2F;&#x2F; Do something when hide.</span><br><span class="line">      &#125;,</span><br><span class="line">      onError (msg) &#123;</span><br><span class="line">        console.log(msg)</span><br><span class="line">      &#125;,</span><br><span class="line">      globalData: &#39;I am global data&#39; &#x2F;&#x2F;全局数据</span><br><span class="line">    &#125;)</span><br><span class="line">2.App实例的调用.</span><br><span class="line">    const appInstance&#x3D;getApp();</span><br><span class="line">    console.log(appInstance.globalData);</span><br></pre></td></tr></table></figure>
<h4 id="注册页面"><a href="#注册页面" class="headerlink" title="注册页面"></a>注册页面</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">1.使用Page构造器注册页面.</span><br><span class="line">    &#x2F;&#x2F;index.js</span><br><span class="line">    Page(&#123;</span><br><span class="line">      data: &#123;</span><br><span class="line">        text: &quot;This is page data.&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      onLoad: function(options) &#123;</span><br><span class="line">        &#x2F;&#x2F; 页面创建时执行</span><br><span class="line">      &#125;,</span><br><span class="line">      onShow: function() &#123;</span><br><span class="line">        &#x2F;&#x2F; 页面出现在前台时执行</span><br><span class="line">      &#125;,</span><br><span class="line">      onReady: function() &#123;</span><br><span class="line">        &#x2F;&#x2F; 页面首次渲染完毕时执行</span><br><span class="line">      &#125;,</span><br><span class="line">      onHide: function() &#123;</span><br><span class="line">        &#x2F;&#x2F; 页面从前台变为后台时执行</span><br><span class="line">      &#125;,</span><br><span class="line">      onUnload: function() &#123;</span><br><span class="line">        &#x2F;&#x2F; 页面销毁时执行</span><br><span class="line">      &#125;,</span><br><span class="line">      onPullDownRefresh: function() &#123;</span><br><span class="line">        &#x2F;&#x2F; 触发下拉刷新时执行</span><br><span class="line">      &#125;,</span><br><span class="line">      onReachBottom: function() &#123;</span><br><span class="line">        &#x2F;&#x2F; 页面触底时执行</span><br><span class="line">      &#125;,</span><br><span class="line">      onShareAppMessage: function () &#123;</span><br><span class="line">        &#x2F;&#x2F; 页面被用户分享时执行</span><br><span class="line">      &#125;,</span><br><span class="line">      onPageScroll: function() &#123;</span><br><span class="line">        &#x2F;&#x2F; 页面滚动时执行</span><br><span class="line">      &#125;,</span><br><span class="line">      onResize: function() &#123;</span><br><span class="line">        &#x2F;&#x2F; 页面尺寸变化时执行</span><br><span class="line">      &#125;,</span><br><span class="line">      onTabItemTap(item) &#123;</span><br><span class="line">        &#x2F;&#x2F; tab 点击时执行</span><br><span class="line">        console.log(item.index)</span><br><span class="line">        console.log(item.pagePath)</span><br><span class="line">        console.log(item.text)</span><br><span class="line">      &#125;,</span><br><span class="line">      &#x2F;&#x2F; 事件响应函数</span><br><span class="line">      viewTap: function() &#123;</span><br><span class="line">        this.setData(&#123;</span><br><span class="line">          text: &#39;Set some data for updating view.&#39;</span><br><span class="line">        &#125;, function() &#123;</span><br><span class="line">          &#x2F;&#x2F; this is setData callback</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      &#x2F;&#x2F; 自由数据</span><br><span class="line">      customData: &#123;</span><br><span class="line">        hi: &#39;MINA&#39;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">2.在页面中使用behaviors.</span><br><span class="line">  页面可以引用behaviors,behaviors可以用来让多个页面具有相同的数据字段和方法.</span><br><span class="line">  &#x2F;&#x2F; my-behavior.js</span><br><span class="line">  module.exports &#x3D; Behavior(&#123;</span><br><span class="line">    data: &#123;</span><br><span class="line">      sharedText: &#39;This is a piece of data shared between pages.&#39;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      sharedMethod: function() &#123;</span><br><span class="line">        this.data.sharedText &#x3D;&#x3D;&#x3D; &#39;This is a piece of data shared between pages.&#39;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  &#x2F;&#x2F; page-a.js</span><br><span class="line">  var myBehavior &#x3D; require(&#39;.&#x2F;my-behavior.js&#39;)</span><br><span class="line">  Page(&#123;</span><br><span class="line">    behaviors: [myBehavior],</span><br><span class="line">    onLoad: function() &#123;</span><br><span class="line">      this.data.sharedText &#x3D;&#x3D;&#x3D; &#39;This is a piece of data shared between pages.&#39;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">3.使用component构造器构造页面.</span><br><span class="line">  Component用于构造复杂的页面.</span><br><span class="line">    Component(&#123;</span><br><span class="line">      data: &#123;</span><br><span class="line">        text: &quot;This is page data.&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      methods: &#123;</span><br><span class="line">        onLoad: function(options) &#123;</span><br><span class="line">          &#x2F;&#x2F; 页面创建时执行</span><br><span class="line">        &#125;,</span><br><span class="line">        onPullDownRefresh: function() &#123;</span><br><span class="line">          &#x2F;&#x2F; 下拉刷新时执行</span><br><span class="line">        &#125;,</span><br><span class="line">        &#x2F;&#x2F; 事件响应函数</span><br><span class="line">        viewTap: function() &#123;</span><br><span class="line">          &#x2F;&#x2F; ...</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>
<h4 id="页面生命周期"><a href="#页面生命周期" class="headerlink" title="页面生命周期"></a>页面生命周期</h4><p><img src="/2020/07/02/wx-mini-program/page-lifecycle.png" alt></p>
<h3 id="页面路由"><a href="#页面路由" class="headerlink" title="页面路由"></a>页面路由</h3><h4 id="页面栈"><a href="#页面栈" class="headerlink" title="页面栈"></a>页面栈</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">框架以栈的形式维护了当前的所有页面,当发生路由切换时候,页面栈表现如下.</span><br><span class="line">    路由方式	    页面栈表现</span><br><span class="line">    初始化	    新页面入栈</span><br><span class="line">    打开新页面	新页面入栈</span><br><span class="line">    页面重定向	当前页面出栈，新页面入栈</span><br><span class="line">    页面返回	    页面不断出栈，直到目标返回页</span><br><span class="line">    Tab 切换	页面全部出栈，只留下新的 Tab 页面</span><br><span class="line">    重加载	    页面全部出栈，只留下新的页面</span><br></pre></td></tr></table></figure>
<h4 id="路由方式"><a href="#路由方式" class="headerlink" title="路由方式"></a>路由方式</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">1.路由.</span><br><span class="line">    路由方式    	    触发时机	                                     路由前页面	        路由后页面</span><br><span class="line">    初始化	    小程序打开的第一个页面	                                            onLoad, onShow</span><br><span class="line">    打开新页面	调用 API wx.navigateTo </span><br><span class="line">                使用组件 &lt;navigator open-type&#x3D;&quot;navigateTo&quot;&#x2F;&gt;	        onHide       	onLoad, onShow</span><br><span class="line">    页面重定向	调用 API wx.redirectTo </span><br><span class="line">                使用组件 &lt;navigator open-type&#x3D;&quot;redirectTo&quot;&#x2F;&gt;	       onUnload	        onLoad, onShow</span><br><span class="line">    页面返回	    调用 API wx.navigateBack </span><br><span class="line">                使用组件&lt;navigator open-type&#x3D;&quot;navigateBack&quot;&gt;</span><br><span class="line">                用户按左上角返回按钮	                                onUnload	    onShow</span><br><span class="line">    Tab 切换	调用 API wx.switchTab </span><br><span class="line">                使用组件 &lt;navigator open-type&#x3D;&quot;switchTab&quot;&#x2F;&gt; </span><br><span class="line">                用户切换 Tab		                                    各种情况请参考下表</span><br><span class="line">    重启动	    调用 API wx.reLaunch </span><br><span class="line">                使用组件 &lt;navigator open-type&#x3D;&quot;reLaunch&quot;&#x2F;&gt;	        onUnload    	onLoad, onShow</span><br><span class="line">                </span><br><span class="line">2.Tab 切换对应的生命周期（以 A、B 页面为 Tabbar 页面，C 是从 A 页面打开的页面，D 页面是从 C 页面打开的页面为例）：</span><br><span class="line">当前页面	路由后页面	触发的生命周期（按顺序）</span><br><span class="line">A	        A	        Nothing happend</span><br><span class="line">A	        B       	A.onHide(), B.onLoad(), B.onShow()</span><br><span class="line">A	        B（再次打开） A.onHide(), B.onShow()</span><br><span class="line">C	        A       	C.onUnload(), A.onShow()</span><br><span class="line">C	        B	        C.onUnload(), B.onLoad(), B.onShow()</span><br><span class="line">D	        B	        D.onUnload(), C.onUnload(), B.onLoad(), B.onShow()</span><br><span class="line">D（从转发进入）	A	    D.onUnload(), A.onLoad(), A.onShow()</span><br><span class="line">D（从转发进入）	B	    D.onUnload(), B.onLoad(), B.onShow()</span><br><span class="line"></span><br><span class="line">3.Tips:</span><br><span class="line">    navigateTo, redirectTo 只能打开非 tabBar 页面。</span><br><span class="line">    switchTab 只能打开 tabBar 页面。</span><br><span class="line">    reLaunch 可以打开任意页面。</span><br><span class="line">    页面底部的 tabBar 由页面决定，即只要是定义为 tabBar 的页面，底部都有 tabBar。</span><br><span class="line">    调用页面路由带的参数可以在目标页面的onLoad中获取。</span><br></pre></td></tr></table></figure>
<h3 id="模块化"><a href="#模块化" class="headerlink" title="模块化"></a>模块化</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">1.可以将一些公共的代码抽离成为一个单独的 js 文件，作为一个模块。</span><br><span class="line">  模块通过module.exports或exports对外暴露接口.</span><br><span class="line">2.注意点.</span><br><span class="line">  1.exports是module.exports的一个引用.</span><br><span class="line">  2.小程序不支持直接引入node_modules,开发者需要使用到 node_modules 时候建议拷贝出相关的代码到小程序的目录中，或者使用小程序支持的 npm 功能。</span><br><span class="line">    &#x2F;&#x2F; common.js</span><br><span class="line">    function sayHello(name) &#123;</span><br><span class="line">      console.log(&#96;Hello $&#123;name&#125; !&#96;)</span><br><span class="line">    &#125;</span><br><span class="line">    function sayGoodbye(name) &#123;</span><br><span class="line">      console.log(&#96;Goodbye $&#123;name&#125; !&#96;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    module.exports.sayHello &#x3D; sayHello</span><br><span class="line">    exports.sayGoodbye &#x3D; sayGoodbye</span><br><span class="line">3.在需要这些模块的文件中,使用require将公共代码引入.</span><br><span class="line">    var common &#x3D; require(&#39;common.js&#39;)</span><br><span class="line">    Page(&#123;</span><br><span class="line">      helloMINA: function() &#123;</span><br><span class="line">        common.sayHello(&#39;MINA&#39;)</span><br><span class="line">      &#125;,</span><br><span class="line">      goodbyeMINA: function() &#123;</span><br><span class="line">        common.sayGoodbye(&#39;MINA&#39;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>
<h4 id="文件作用域"><a href="#文件作用域" class="headerlink" title="文件作用域"></a>文件作用域</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1.getApp -&gt; 获取全局的应用实例.</span><br><span class="line">  全局数据的设置</span><br><span class="line">  &#x2F;&#x2F;app.js</span><br><span class="line">  App(&#123;</span><br><span class="line">      globalData: 1</span><br><span class="line">  &#125;)</span><br><span class="line">  &#x2F;&#x2F;a.js</span><br><span class="line">  var localValue &#x3D; &#39;a&#39;</span><br><span class="line">  &#x2F;&#x2F; Get the app instance.</span><br><span class="line">  var app &#x3D; getApp()</span><br><span class="line">  &#x2F;&#x2F; Get the global data and change it.</span><br><span class="line">  app.globalData++</span><br><span class="line">  &#x2F;&#x2F;b.js</span><br><span class="line">  var localValue &#x3D; &#39;b&#39;</span><br><span class="line">  &#x2F;&#x2F; If a.js it run before b.js, now the globalData shoule be 2.</span><br><span class="line">  console.log(getApp().globalData)</span><br></pre></td></tr></table></figure>
<h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">小程序开发框架提供丰富的微信原生 API，可以方便的调起微信提供的能力，如获取用户信息，本地存储，支付功能等。详细介绍请参考 API 文档。</span><br></pre></td></tr></table></figure>
<h4 id="事件监听API"><a href="#事件监听API" class="headerlink" title="事件监听API"></a>事件监听API</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">on开头的API用来监听某个事件是否触发,如:wx.onSocketOpen、wx.onCompassChange(指南针方向改变)</span><br><span class="line">例如: </span><br><span class="line">wx.onCompassChange(function(res)&#123;</span><br><span class="line">    console.log(res.direction);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="同步API"><a href="#同步API" class="headerlink" title="同步API"></a>同步API</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1.以Sync结尾的API都是同步API,如</span><br><span class="line">  wx.setStorageSync</span><br><span class="line">  wx.getStorageSync</span><br><span class="line">例:</span><br><span class="line">    try &#123;</span><br><span class="line">      wx.setStorageSync(&#39;key&#39;, &#39;value&#39;)</span><br><span class="line">    &#125; catch (e) &#123;</span><br><span class="line">      console.error(e)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="异步API"><a href="#异步API" class="headerlink" title="异步API"></a>异步API</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">1.参数说明</span><br><span class="line">  &#123;</span><br><span class="line">      success:function(res)&#123;</span><br><span class="line">      </span><br><span class="line">        &#125;,</span><br><span class="line">      fail:function(res)&#123;</span><br><span class="line">          </span><br><span class="line">      &#125;,</span><br><span class="line">      complete:function(res)&#123;</span><br><span class="line">          </span><br><span class="line">      &#125;,</span><br><span class="line">      ....</span><br><span class="line">  &#125;</span><br><span class="line">2.例子.</span><br><span class="line">wx.login(&#123;</span><br><span class="line">  success(res) &#123;</span><br><span class="line">    console.log(res.code)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="异步API返回Promise"><a href="#异步API返回Promise" class="headerlink" title="异步API返回Promise"></a>异步API返回Promise</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1.基础库 2.10.2 版本起，异步 API 支持 callback &amp; promise 两种调用方式。当接口参数 Object 对象中不包含 success&#x2F;fail&#x2F;complete 时将默认返回 promise，否则仍按回调方式执行，无返回值</span><br><span class="line">2.注意事项.</span><br><span class="line">  1.部分接口如 downloadFile, request, uploadFile, connectSocket, createCamera（小游戏）本身就有返回值， 它们的 promisify 需要开发者自行封装。</span><br><span class="line">  2.当没有回调参数时，异步接口返回 promise。此时若函数调用失败进入 fail 逻辑， 会报错提示 Uncaught (in promise)，开发者可通过 catch 来进行捕获。</span><br><span class="line">  3.wx.onUnhandledRejection 可以监听未处理的 Promise 拒绝事件。</span><br><span class="line">3.举例子.</span><br><span class="line">    &lt;!-- callback 形式调用 --&gt;</span><br><span class="line">    wx.chooseImage(&#123;</span><br><span class="line">      success(res) &#123;</span><br><span class="line">        console.log(&#39;res:&#39;, res)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    &lt;!-- promise 形式调用 --&gt;</span><br><span class="line">    wx.chooseImage().then(res &#x3D;&gt; console.log(&#39;res: &#39;, res))</span><br></pre></td></tr></table></figure>
<h3 id="视图层"><a href="#视图层" class="headerlink" title="视图层"></a>视图层</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">框架的视图层由 WXML 与 WXSS 编写，由组件来进行展示。</span><br><span class="line"></span><br><span class="line">将逻辑层的数据反应成视图，同时将视图层的事件发送给逻辑层。</span><br><span class="line"></span><br><span class="line">WXML(WeiXin Markup language) 用于描述页面的结构。</span><br><span class="line"></span><br><span class="line">WXS(WeiXin Script) 是小程序的一套脚本语言，结合 WXML，可以构建出页面的结构。</span><br><span class="line"></span><br><span class="line">WXSS(WeiXin Style Sheet) 用于描述页面的样式。</span><br><span class="line"></span><br><span class="line">组件(Component)是视图的基本组成单元。</span><br></pre></td></tr></table></figure>
<h4 id="wxml"><a href="#wxml" class="headerlink" title="wxml"></a>wxml</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">1.WXML（WeiXin Markup Language）是框架设计的一套标签语言，结合基础组件、事件系统，可以构建出页面的结构。</span><br><span class="line">2.数据绑定.</span><br><span class="line">    &lt;!--wxml--&gt;</span><br><span class="line">    &lt;view&gt; &#123;&#123;message&#125;&#125; &lt;&#x2F;view&gt;</span><br><span class="line">    &#x2F;&#x2F; page.js</span><br><span class="line">    Page(&#123;</span><br><span class="line">      data: &#123;</span><br><span class="line">        message: &#39;Hello MINA!&#39;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">3.列表渲染.</span><br><span class="line">    &lt;!--wxml--&gt;</span><br><span class="line">    &lt;view wx:for&#x3D;&quot;&#123;&#123;array&#125;&#125;&quot;&gt; &#123;&#123;item&#125;&#125; &lt;&#x2F;view&gt;</span><br><span class="line">    &#x2F;&#x2F; page.js</span><br><span class="line">    Page(&#123;</span><br><span class="line">      data: &#123;</span><br><span class="line">        array: [1, 2, 3, 4, 5]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">4.条件渲染.</span><br><span class="line">    &lt;!--wxml--&gt;</span><br><span class="line">    &lt;view wx:if&#x3D;&quot;&#123;&#123;view &#x3D;&#x3D; &#39;WEBVIEW&#39;&#125;&#125;&quot;&gt; WEBVIEW &lt;&#x2F;view&gt;</span><br><span class="line">    &lt;view wx:elif&#x3D;&quot;&#123;&#123;view &#x3D;&#x3D; &#39;APP&#39;&#125;&#125;&quot;&gt; APP &lt;&#x2F;view&gt;</span><br><span class="line">    &lt;view wx:else&#x3D;&quot;&#123;&#123;view &#x3D;&#x3D; &#39;MINA&#39;&#125;&#125;&quot;&gt; MINA &lt;&#x2F;view&gt;</span><br><span class="line">    &#x2F;&#x2F; page.js</span><br><span class="line">    Page(&#123;</span><br><span class="line">      data: &#123;</span><br><span class="line">        view: &#39;MINA&#39;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">5.模板</span><br><span class="line">&lt;!--wxml--&gt;</span><br><span class="line">&lt;template name&#x3D;&quot;staffName&quot;&gt;</span><br><span class="line">  &lt;view&gt;</span><br><span class="line">    FirstName: &#123;&#123;firstName&#125;&#125;, LastName: &#123;&#123;lastName&#125;&#125;</span><br><span class="line">  &lt;&#x2F;view&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;template is&#x3D;&quot;staffName&quot; data&#x3D;&quot;&#123;&#123;...staffA&#125;&#125;&quot;&gt;&lt;&#x2F;template&gt;</span><br><span class="line">&lt;template is&#x3D;&quot;staffName&quot; data&#x3D;&quot;&#123;&#123;...staffB&#125;&#125;&quot;&gt;&lt;&#x2F;template&gt;</span><br><span class="line">&lt;template is&#x3D;&quot;staffName&quot; data&#x3D;&quot;&#123;&#123;...staffC&#125;&#125;&quot;&gt;&lt;&#x2F;template&gt;</span><br><span class="line">&#x2F;&#x2F; page.js</span><br><span class="line">Page(&#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    staffA: &#123;firstName: &#39;Hulk&#39;, lastName: &#39;Hu&#39;&#125;,</span><br><span class="line">    staffB: &#123;firstName: &#39;Shang&#39;, lastName: &#39;You&#39;&#125;,</span><br><span class="line">    staffC: &#123;firstName: &#39;Gideon&#39;, lastName: &#39;Lin&#39;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="WXSS"><a href="#WXSS" class="headerlink" title="WXSS"></a>WXSS</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">1.与 CSS 相比，WXSS 扩展的特性有</span><br><span class="line">  尺寸单位 + 样式导入.</span><br><span class="line">2.尺寸单位.</span><br><span class="line">  rpx  -&gt;  responsive pixel.</span><br><span class="line">3.样式导入.</span><br><span class="line">  @import &quot;common.wxss&quot;;</span><br><span class="line">4.内联样式.</span><br><span class="line">    &lt;view style&#x3D;&quot;color:&#123;&#123;color&#125;&#125;;&quot; &#x2F;&gt;</span><br><span class="line">    &lt;view class&#x3D;&quot;normal_view&quot; &#x2F;&gt;</span><br><span class="line">5.选择器.</span><br><span class="line">    选择器	        样例	        样例描述</span><br><span class="line">    .class      	.intro      	选择所有拥有 class&#x3D;&quot;intro&quot; 的组件</span><br><span class="line">    #id	            #firstname	   选择拥有 id&#x3D;&quot;firstname&quot; 的组件</span><br><span class="line">    element	        view	        选择所有 view 组件</span><br><span class="line">    element, element	view, checkbox	选择所有文档的 view 组件和所有的 checkbox 组件</span><br><span class="line">    ::after	    view::after	        在 view 组件后边插入内容</span><br><span class="line">    ::before	view::before	    在 view 组件前边插入内容</span><br><span class="line">6.全局样式与局部样式.</span><br><span class="line">    app.wxss  -&gt;  全局样式</span><br><span class="line">    page.wxss -&gt;  局部样式</span><br></pre></td></tr></table></figure>
<h3 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">1.什么是事件?</span><br><span class="line">    1.事件是视图层到逻辑层的通讯方式。</span><br><span class="line">    2.事件可以将用户的行为反馈到逻辑层进行处理。</span><br><span class="line">    3.事件可以绑定在组件上，当达到触发事件，就会执行逻辑层中对应的事件处理函数。</span><br><span class="line">    4.事件对象可以携带额外信息，如 id, dataset, touches。</span><br><span class="line">2.事件的简单使用.</span><br><span class="line">    &#x2F;&#x2F;xhtml</span><br><span class="line">    &lt;view id&#x3D;&quot;tapTest&quot; data-hi&#x3D;&quot;WeChat&quot; bindtap&#x3D;&quot;tapName&quot;&gt; Click me! &lt;&#x2F;view&gt;</span><br><span class="line">    &#x2F;&#x2F;page.js</span><br><span class="line">    Page(&#123;</span><br><span class="line">      tapName: function(event) &#123;</span><br><span class="line">        console.log(event)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">3.事件分类.</span><br><span class="line">    1.冒泡事件: 当上一个组件上的事件触发时候,该事件会向父节点传递.</span><br><span class="line">    2.非冒泡事件: 当上一个组件上的事件触发时候,该事件不会向父节点传递.</span><br><span class="line">    类型	            触发条件	                        最低版本</span><br><span class="line">    touchstart	    手指触摸动作开始	</span><br><span class="line">    touchmove	    手指触摸后移动	</span><br><span class="line">    touchcancel	    手指触摸动作被打断，如来电提醒，弹窗	</span><br><span class="line">    touchend	    手指触摸动作结束	</span><br><span class="line">    tap	            手指触摸后马上离开	</span><br><span class="line">    longpress	    手指触摸后，超过350ms再离开，如果指定了事件回调函数并触发了这个事件，tap事件将不被触发	1.5.0</span><br><span class="line">    longtap	        手指触摸后，超过350ms再离开（推荐使用longpress事件代替）	</span><br><span class="line">    transitionend	会在 WXSS transition 或 wx.createAnimation 动画结束后触发	</span><br><span class="line">    animationstart	会在一个 WXSS animation 动画开始时触发	</span><br><span class="line">    animationiteration	会在一个 WXSS animation 一次迭代结束时触发	</span><br><span class="line">    animationend	会在一个 WXSS animation 动画完成时触发	</span><br><span class="line">    touchforcechange	在支持 3D Touch 的 iPhone 设备，重按时会触发</span><br><span class="line">4.绑定并阻止事件冒泡.</span><br><span class="line">  例如:</span><br><span class="line">    &lt;view id&#x3D;&quot;outer&quot; bindtap&#x3D;&quot;handleTap1&quot;&gt;</span><br><span class="line">      outer view</span><br><span class="line">      &lt;view id&#x3D;&quot;middle&quot; catchtap&#x3D;&quot;handleTap2&quot;&gt;</span><br><span class="line">        middle view</span><br><span class="line">        &lt;view id&#x3D;&quot;inner&quot; bindtap&#x3D;&quot;handleTap3&quot;&gt;</span><br><span class="line">          inner view</span><br><span class="line">        &lt;&#x2F;view&gt;</span><br><span class="line">      &lt;&#x2F;view&gt;</span><br><span class="line">    &lt;&#x2F;view&gt;</span><br><span class="line">  冒泡到middle view后就不会向上继续冒泡.</span><br><span class="line">5.事件捕获阶段.</span><br><span class="line">  1.自基础库版本 1.5.0 起，触摸类事件支持捕获阶段。捕获阶段位于冒泡阶段之前，且在捕获阶段中，事件到达节点的顺序与冒泡阶段恰好相反.</span><br><span class="line">  2.需要在捕获阶段监听事件时，可以采用capture-bind、capture-catch(中断捕获阶段和取消冒泡阶段)关键字.</span><br><span class="line">6.事件对象.</span><br><span class="line">   1.事件触发时候,逻辑层事件处理函数会收到视图层的一个事件对象.</span><br><span class="line">   BaseEvent 基础事件对象属性列表:</span><br><span class="line">       属性	        类型	        说明	 </span><br><span class="line">       type     	String	        事件类型	</span><br><span class="line">       timeStamp	Integer	        事件生成时的时间戳	</span><br><span class="line">       target	    Object	        触发事件的组件的一些属性值集合	</span><br><span class="line">       currentTarget	Object	    当前组件的一些属性值集合	</span><br><span class="line">       mark     	Object	        事件标记数据</span><br><span class="line">   2.CustomEvent 自定义事件对象属性列表（继承 BaseEvent）</span><br><span class="line">       属性	        类型	    说明</span><br><span class="line">       detail   	Object	    额外的信息</span><br><span class="line">   3.TouchEvent 触摸事件对象属性列表（继承 BaseEvent）：</span><br><span class="line">       属性	             类型	          说明</span><br><span class="line">       touches	        Array	        触摸事件，当前停留在屏幕中的触摸点信息的数组</span><br><span class="line">       changedTouches	Array	        触摸事件，当前变化的触摸点信息的数组</span><br><span class="line">7.简易双向绑定.</span><br><span class="line">  1.默认是单向的.</span><br><span class="line">    &lt;input value&#x3D;&quot;&#123;&#123;value&#125;&#125;&quot;&#x2F;&gt;</span><br><span class="line">    通过this.setData(value,&#39;leaf&#39;)可以改变输入框的值,但是改变输入框的值并不会改变value.</span><br><span class="line">  2.双向绑定.</span><br><span class="line">    &lt;input model:value&#x3D;&quot;&#123;&#123;value&#125;&#125;&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure>
<h3 id="基础组件"><a href="#基础组件" class="headerlink" title="基础组件"></a>基础组件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1.组件.</span><br><span class="line">    组件是视图层的基本组成单元。</span><br><span class="line">    组件自带一些功能与微信风格一致的样式。</span><br><span class="line">    一个组件通常包括 开始标签 和 结束标签，属性 用来修饰这个组件，内容 在两个标签之内。</span><br><span class="line">2.属性.</span><br><span class="line">    属性名	    类型	描述	注解</span><br><span class="line">    id	String	组件的唯一标示	保持整个页面唯一</span><br><span class="line">    class	String	组件的样式类	在对应的 WXSS 中定义的样式类</span><br><span class="line">    style	String	组件的内联样式	可以动态设置的内联样式</span><br><span class="line">    hidden	Boolean	组件是否显示	所有组件默认显示</span><br><span class="line">    data-*	Any	自定义属性	组件上触发的事件时，会发送给事件处理函数</span><br><span class="line">    bind* &#x2F; catch*	EventHandler	组件的事件	详见事件</span><br></pre></td></tr></table></figure>
<h3 id="获取界面上的节点信息"><a href="#获取界面上的节点信息" class="headerlink" title="获取界面上的节点信息"></a>获取界面上的节点信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1.示例.</span><br><span class="line">    const query &#x3D; wx.createSelectorQuery()</span><br><span class="line">    query.select(&#39;#the-id&#39;).boundingClientRect(function(res)&#123;</span><br><span class="line">      res.top &#x2F;&#x2F; #the-id 节点的上边界坐标（相对于显示区域）</span><br><span class="line">    &#125;)</span><br><span class="line">    query.selectViewport().scrollOffset(function(res)&#123;</span><br><span class="line">      res.scrollTop &#x2F;&#x2F; 显示区域的竖直滚动位置</span><br><span class="line">    &#125;)</span><br><span class="line">    query.exec()</span><br></pre></td></tr></table></figure>
<h3 id="初始渲染缓存"><a href="#初始渲染缓存" class="headerlink" title="初始渲染缓存"></a>初始渲染缓存</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">1.小程序页面初始化.</span><br><span class="line">    逻辑层初始化：载入必需的小程序代码、初始化页面 this 对象（也包括它涉及到的所有自定义组件的 this 对象）、将相关数据发送给视图层。</span><br><span class="line">    视图层初始化：载入必需的小程序代码，然后等待逻辑层初始化完毕并接收逻辑层发送的数据，最后渲染页面。</span><br><span class="line">2.启用初始渲染缓存，可以使视图层不需要等待逻辑层初始化完毕，而直接提前将页面初始 data 的渲染结果展示给用户，这可以使得页面对用户可见的时间大大提前。它的工作原理如下：</span><br><span class="line">    1.在小程序页面第一次被打开后，将页面初始数据渲染结果记录下来，写入一个持久化的缓存区域（缓存可长时间保留，但可能因为小程序更新、基础库更新、储存空间回收等原因被清除）；</span><br><span class="line">    2.在这个页面被第二次打开时，检查缓存中是否还存有这个页面上一次初始数据的渲染结果，如果有，就直接将渲染结果展示出来；</span><br><span class="line">    3.如果展示了缓存中的渲染结果，这个页面暂时还不能响应用户事件，等到逻辑层初始化完毕后才能响应用户事件。</span><br><span class="line">3.利用初始渲染缓存，可以:</span><br><span class="line">    快速展示出页面中永远不会变的部分，如导航栏；</span><br><span class="line">    预先展示一个骨架页，提升用户体验；</span><br><span class="line">    展示自定义的加载提示；</span><br><span class="line">    提前展示广告，等等.</span><br><span class="line">4.支持的组件.</span><br><span class="line">    在初始渲染缓存阶段中，复杂组件不能被展示或不能响应交互。</span><br><span class="line">    目前支持的内置组件：</span><br><span class="line">        &lt;view &#x2F;&gt;</span><br><span class="line">        &lt;text &#x2F;&gt;</span><br><span class="line">        &lt;button &#x2F;&gt;</span><br><span class="line">        &lt;image &#x2F;&gt;</span><br><span class="line">        &lt;scroll-view &#x2F;&gt;</span><br><span class="line">        &lt;rich-text &#x2F;&gt;</span><br><span class="line">5.静态初始渲染缓存.</span><br><span class="line">    在页面的 json 文件中添加配置项 &quot;initialRenderingCache&quot;: &quot;static&quot;</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;initialRenderingCache&quot;: &quot;static&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    如果想要对所有页面启用，可以在 app.json 的 window 配置段中添加这个配置：</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;window&quot;: &#123;</span><br><span class="line">        &quot;initialRenderingCache&quot;: &quot;static&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  taps:缓存并不会缓存页面的改变状态,例如通过this.setData(&#39;name&#39;,&#39;value&#39;);</span><br><span class="line">       而是缓存页面对应js配置的data</span><br><span class="line">       如 Page(&#123;</span><br><span class="line">           data:&#123;</span><br><span class="line">               loading: true</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;)</span><br><span class="line">6.在初始渲染缓存中添加动态内容.</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;initialRenderingCache&quot;: &quot;dynamic&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    此时，初始渲染缓存不会被自动启用，还需要在页面中调用 this.setInitialRenderingCache(dynamicData) 才能启用。其中， dynamicData 是一组数据，与 data 一起参与页面 WXML 渲染。</span><br><span class="line">    Page(&#123;</span><br><span class="line">      data: &#123;</span><br><span class="line">        loading: true</span><br><span class="line">      &#125;,</span><br><span class="line">      onReady: function() &#123;</span><br><span class="line">        this.setInitialRenderingCache(&#123;</span><br><span class="line">          loadingHint: &#39;正在加载&#39; &#x2F;&#x2F; 这一部分数据将被应用于界面上，相当于在初始 data 基础上额外进行一次 setData</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &lt;view wx:if&#x3D;&quot;&#123;&#123;loading&#125;&#125;&quot;&gt;&#123;&#123;loadingHint&#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">taps:</span><br><span class="line">    this.setInitialRenderingCache 调用时机不能早于 Page 的 onReady 或 Component 的 ready 生命周期，否则可能对性能有负面影响。</span><br><span class="line">    如果想禁用初始渲染缓存，调用 this.setInitialRenderingCache(null) 。</span><br></pre></td></tr></table></figure>
<h2 id="自定义组件"><a href="#自定义组件" class="headerlink" title="自定义组件"></a>自定义组件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">开发者可以将页面内的功能模块抽象成自定义组件，以便在不同的页面中重复使用；也可以将复杂的页面拆分成多个低耦合的模块，有助于代码维护。自定义组件在使用时与基础组件非常相似。</span><br></pre></td></tr></table></figure>
<h3 id="简单使用"><a href="#简单使用" class="headerlink" title="简单使用"></a>简单使用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">1.自定义组件由json、wxml、wxss、js4个文件组成.</span><br><span class="line">  1.json</span><br><span class="line">      &#123;</span><br><span class="line">          &quot;component&quot;:true</span><br><span class="line">      &#125;</span><br><span class="line">  2.wxml</span><br><span class="line">     &lt;view class&#x3D;&quot;inner&quot;&gt;</span><br><span class="line">        &#123;&#123;innerText&#125;&#125;</span><br><span class="line">     &lt;&#x2F;view&gt;</span><br><span class="line">     &lt;slot&gt;&lt;&#x2F;slot&gt;</span><br><span class="line">  3.wxss</span><br><span class="line">    .inner&#123;</span><br><span class="line">        color: red;</span><br><span class="line">    &#125;</span><br><span class="line">  4.js</span><br><span class="line">    Component(&#123;</span><br><span class="line">        properties:&#123; &#x2F;&#x2F;组件的properties,有点像react component.</span><br><span class="line">            innerText:&#123;</span><br><span class="line">                type: String,</span><br><span class="line">                value: &quot;default value&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        data:&#123;</span><br><span class="line">            someData:&#123;&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        methods:&#123;</span><br><span class="line">            customMethod: function()&#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">2.组件使用.</span><br><span class="line">  1.page -&gt; json</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;usingComponents&quot;:&#123;</span><br><span class="line">            &quot;component-tag-name&quot;:&quot;path&#x2F;to&#x2F;the&#x2F;custom&#x2F;component&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  2.page -&gt; wxml</span><br><span class="line">    &lt;view&gt;</span><br><span class="line">      &lt;!-- 以下是对一个自定义组件的引用 --&gt;</span><br><span class="line">      &lt;component-tag-name inner-text&#x3D;&quot;Some text&quot;&gt;</span><br><span class="line">        &lt;view&gt;这里是插入到组件slot中的内容&lt;&#x2F;view&gt;</span><br><span class="line">      &lt;&#x2F;component-tag-name&gt;</span><br><span class="line">    &lt;&#x2F;view&gt;</span><br><span class="line">3.细节注意事项.</span><br><span class="line"></span><br><span class="line">    1.因为 WXML 节点标签名只能是小写字母、中划线和下划线的组合，所以自定义组件的标签名也只能包含这些字符。</span><br><span class="line">    2.自定义组件也是可以引用自定义组件的，引用方法类似于页面引用自定义组件的方式（使用 usingComponents 字段）。</span><br><span class="line">    3.自定义组件和页面所在项目根目录名不能以“wx-”为前缀，否则会报错。</span><br><span class="line">    4.注意，是否在页面文件中使用 usingComponents 会使得页面的 this 对象的原型稍有差异，包括：</span><br><span class="line">        1.使用 usingComponents 页面的原型与不使用时不一致，即 Object.getPrototypeOf(this) 结果不同。</span><br><span class="line">        2.使用 usingComponents 时会多一些方法，如 selectComponent 。</span><br><span class="line">        3.出于性能考虑，使用 usingComponents 时， setData 内容不会被直接深复制，即 this.setData(&#123; field: obj &#125;) 后 this.data.field &#x3D;&#x3D;&#x3D; obj 。（深复制会在这个值被组件间传递时发生。）</span><br></pre></td></tr></table></figure>
<h3 id="组件模板和样式"><a href="#组件模板和样式" class="headerlink" title="组件模板和样式"></a>组件模板和样式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">1.组件wxml的slot.</span><br><span class="line">  1.在组件的 wxml 中可以包含 slot 节点，用于承载组件使用者提供的 wxml 结构。</span><br><span class="line">  2.默认只有一个slot,当需要多slot时候,在js中启用声明.</span><br><span class="line">    Component(&#123;</span><br><span class="line">      options: &#123;</span><br><span class="line">        multipleSlots: true &#x2F;&#x2F; 在组件定义时的选项中启用多slot支持</span><br><span class="line">      &#125;,</span><br><span class="line">      properties: &#123; &#x2F;* ... *&#x2F; &#125;,</span><br><span class="line">      methods: &#123; &#x2F;* ... *&#x2F; &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    &#x2F;&#x2F;compoent wxml</span><br><span class="line">    &lt;view class&#x3D;&quot;wrapper&quot;&gt;</span><br><span class="line">      &lt;slot name&#x3D;&quot;before&quot;&gt;&lt;&#x2F;slot&gt;</span><br><span class="line">      &lt;view&gt;这里是组件的内部细节&lt;&#x2F;view&gt;</span><br><span class="line">      &lt;slot name&#x3D;&quot;after&quot;&gt;&lt;&#x2F;slot&gt;</span><br><span class="line">    &lt;&#x2F;view&gt;</span><br><span class="line">    &#x2F;&#x2F;page wxml</span><br><span class="line">    &lt;!-- 引用组件的页面模板 --&gt;</span><br><span class="line">    &lt;view&gt;</span><br><span class="line">      &lt;component-tag-name&gt;</span><br><span class="line">        &lt;!-- 这部分内容将被放置在组件 &lt;slot name&#x3D;&quot;before&quot;&gt; 的位置上 --&gt;</span><br><span class="line">        &lt;view slot&#x3D;&quot;before&quot;&gt;这里是插入到组件slot name&#x3D;&quot;before&quot;中的内容&lt;&#x2F;view&gt;</span><br><span class="line">        &lt;!-- 这部分内容将被放置在组件 &lt;slot name&#x3D;&quot;after&quot;&gt; 的位置上 --&gt;</span><br><span class="line">        &lt;view slot&#x3D;&quot;after&quot;&gt;这里是插入到组件slot name&#x3D;&quot;after&quot;中的内容&lt;&#x2F;view&gt;</span><br><span class="line">      &lt;&#x2F;component-tag-name&gt;</span><br><span class="line">    &lt;&#x2F;view&gt;</span><br><span class="line">2.组件样式.</span><br><span class="line">  1.只能出现类选择器</span><br><span class="line">  如:</span><br><span class="line">    .left</span><br><span class="line">    #left  (x)</span><br><span class="line">    [a]    (x)</span><br><span class="line">    button (x)</span><br><span class="line">    .a &gt; .b (x) 继承</span><br><span class="line">  2.默认情况下，自定义组件的样式只受到自定义组件 wxss 的影响.</span><br></pre></td></tr></table></figure>
<h3 id="Component-构造器"><a href="#Component-构造器" class="headerlink" title="Component 构造器"></a>Component 构造器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">1.例子.</span><br><span class="line">    Component(&#123;</span><br><span class="line"></span><br><span class="line">      behaviors: [],</span><br><span class="line"></span><br><span class="line">      properties: &#123;</span><br><span class="line">        myProperty: &#123; &#x2F;&#x2F; 属性名</span><br><span class="line">          type: String,</span><br><span class="line">          value: &#39;&#39;</span><br><span class="line">        &#125;,</span><br><span class="line">        myProperty2: String &#x2F;&#x2F; 简化的定义方式</span><br><span class="line">      &#125;,</span><br><span class="line">      </span><br><span class="line">      data: &#123;&#125;, &#x2F;&#x2F; 私有数据，可用于模板渲染</span><br><span class="line"></span><br><span class="line">      lifetimes: &#123;</span><br><span class="line">        &#x2F;&#x2F; 生命周期函数，可以为函数，或一个在methods段中定义的方法名</span><br><span class="line">        attached: function () &#123; &#125;,</span><br><span class="line">        moved: function () &#123; &#125;,</span><br><span class="line">        detached: function () &#123; &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      &#x2F;&#x2F; 生命周期函数，可以为函数，或一个在methods段中定义的方法名</span><br><span class="line">      attached: function () &#123; &#125;, &#x2F;&#x2F; 此处attached的声明会被lifetimes字段中的声明覆盖</span><br><span class="line">      ready: function() &#123; &#125;,</span><br><span class="line"></span><br><span class="line">      pageLifetimes: &#123;</span><br><span class="line">        &#x2F;&#x2F; 组件所在页面的生命周期函数</span><br><span class="line">        show: function () &#123; &#125;,</span><br><span class="line">        hide: function () &#123; &#125;,</span><br><span class="line">        resize: function () &#123; &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      methods: &#123;</span><br><span class="line">        onMyButtonTap: function()&#123;</span><br><span class="line">          this.setData(&#123;</span><br><span class="line">            &#x2F;&#x2F; 更新属性和数据的方法与更新页面数据的方法类似</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;,</span><br><span class="line">        &#x2F;&#x2F; 内部方法建议以下划线开头</span><br><span class="line">        _myPrivateMethod: function()&#123;</span><br><span class="line">          &#x2F;&#x2F; 这里将 data.A[0].B 设为 &#39;myPrivateData&#39;</span><br><span class="line">          this.setData(&#123;</span><br><span class="line">            &#39;A[0].B&#39;: &#39;myPrivateData&#39;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;,</span><br><span class="line">        _propertyChange: function(newVal, oldVal) &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">2.组件的属性可以用于接收页面的参数，如访问页面 &#x2F;pages&#x2F;index&#x2F;index?paramA&#x3D;123&amp;paramB&#x3D;xyz ，如果声明有属性 paramA 或 paramB ，则它们会被赋值为 123 或 xyz </span><br><span class="line">3.使用 Component 构造器来构造页面的一个好处是可以使用 behaviors 来提取所有页面中公用的代码段.</span><br><span class="line">    &#x2F;&#x2F; page-common-behavior.js</span><br><span class="line">    module.exports &#x3D; Behavior(&#123;</span><br><span class="line">      attached: function() &#123;</span><br><span class="line">        &#x2F;&#x2F; 页面创建时执行</span><br><span class="line">        console.info(&#39;Page loaded!&#39;)</span><br><span class="line">      &#125;,</span><br><span class="line">      detached: function() &#123;</span><br><span class="line">        &#x2F;&#x2F; 页面销毁时执行</span><br><span class="line">        console.info(&#39;Page unloaded!&#39;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    &#x2F;&#x2F; 页面 A</span><br><span class="line">    var pageCommonBehavior &#x3D; require(&#39;.&#x2F;page-common-behavior&#39;)</span><br><span class="line">    Component(&#123;</span><br><span class="line">      behaviors: [pageCommonBehavior],</span><br><span class="line">      data: &#123; &#x2F;* ... *&#x2F; &#125;,</span><br><span class="line">      methods: &#123; &#x2F;* ... *&#x2F; &#125;,</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>
<h3 id="组件间通信和事件"><a href="#组件间通信和事件" class="headerlink" title="组件间通信和事件"></a>组件间通信和事件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">1.组件间通信.</span><br><span class="line">  1.WXML数据绑定.父组件向子组件传递数据.</span><br><span class="line">  2.事件 -&gt; 子组件向父组件传递数据.</span><br><span class="line">  3.父组件 this.selectComponent获取子组件实例对象.</span><br><span class="line">2.触发事件.</span><br><span class="line">  this.triggerEvent(&#39;xxEvent&#39;,xxEventDetail,xxEventOption);</span><br><span class="line">  --&gt;</span><br><span class="line">    xxEventOption -&gt;    bubbles (冒泡) , composed(是否进入组件内部), capturePhase(捕获).</span><br><span class="line">3.获取子组件实例.</span><br><span class="line">  1.this.selectComponent(&#39;.my-component&#39;);</span><br><span class="line">  2.自定义组件的返回内容.</span><br><span class="line">    &#x2F;&#x2F; 自定义组件 my-component 内部</span><br><span class="line">    Component(&#123;</span><br><span class="line">      behaviors: [&#39;wx:&#x2F;&#x2F;component-export&#39;],</span><br><span class="line">      export() &#123;</span><br><span class="line">        return &#123; myField: &#39;myValue&#39; &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    &lt;!-- 使用自定义组件时 --&gt;</span><br><span class="line">    &lt;my-component id&#x3D;&quot;the-id&quot; &#x2F;&gt;</span><br><span class="line">    &#x2F;&#x2F; 父组件调用</span><br><span class="line">    const child &#x3D; this.selectComponent(&#39;#the-id&#39;) &#x2F;&#x2F; 等于 &#123; myField: &#39;myValue&#39; &#125;</span><br></pre></td></tr></table></figure>
<h3 id="组件生命周期"><a href="#组件生命周期" class="headerlink" title="组件生命周期"></a>组件生命周期</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">1.created  -&gt;  组件实例创建时候.</span><br><span class="line">2.attached -&gt;  组件初始化完毕、进入页面节点树后.</span><br><span class="line">3.detached -&gt;  组件离开页面节点树后.</span><br><span class="line">例如:</span><br><span class="line">Component(&#123;</span><br><span class="line">  lifetimes: &#123;</span><br><span class="line">    attached: function() &#123;</span><br><span class="line">      &#x2F;&#x2F; 在组件实例进入页面节点树时执行</span><br><span class="line">    &#125;,</span><br><span class="line">    detached: function() &#123;</span><br><span class="line">      &#x2F;&#x2F; 在组件实例被从页面节点树移除时执行</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#x2F;&#x2F; 以下是旧式的定义方式，可以保持对 &lt;2.2.3 版本基础库的兼容</span><br><span class="line">  attached: function() &#123;</span><br><span class="line">    &#x2F;&#x2F; 在组件实例进入页面节点树时执行</span><br><span class="line">  &#125;,</span><br><span class="line">  detached: function() &#123;</span><br><span class="line">    &#x2F;&#x2F; 在组件实例被从页面节点树移除时执行</span><br><span class="line">  &#125;,</span><br><span class="line">  &#x2F;&#x2F; ...</span><br><span class="line">&#125;)</span><br><span class="line">tips: 在 behaviors 中也可以编写生命周期方法，同时不会与其他 behaviors 中的同名生命周期相互覆盖。</span><br><span class="line">      但要注意，如果一个组件多次直接或间接引用同一个 behavior ，这个 behavior 中的生命周期函数在一个执行时机内只会执行一次。</span><br><span class="line">4.组件生命周期.</span><br><span class="line">  created,attached,ready,moved,detached,error.</span><br><span class="line">5.页面生命周期.</span><br><span class="line">  show,hide,resize.</span><br></pre></td></tr></table></figure>
<h3 id="behaviors"><a href="#behaviors" class="headerlink" title="behaviors"></a>behaviors</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">1.behaviors 是用于组件间代码共享的特性，类似于一些编程语言中的 “mixins” 或 “traits”.</span><br><span class="line">2.每个 behavior 可以包含一组属性、数据、生命周期函数和方法。</span><br><span class="line">  组件引用它时，它的属性、数据和方法会被合并到组件中，生命周期函数也会在对应时机被调用。 </span><br><span class="line">  每个组件可以引用多个 behavior ，behavior 也可以引用其它 behavior </span><br><span class="line">3.组件的使用.</span><br><span class="line">    &#x2F;&#x2F; my-component.js</span><br><span class="line">    var myBehavior &#x3D; require(&#39;my-behavior&#39;)</span><br><span class="line">    Component(&#123;</span><br><span class="line">      behaviors: [myBehavior],</span><br><span class="line">      properties: &#123;</span><br><span class="line">        myProperty: &#123;</span><br><span class="line">          type: String</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      data: &#123;</span><br><span class="line">        myData: &#39;my-component-data&#39;</span><br><span class="line">      &#125;,</span><br><span class="line">      created: function () &#123;</span><br><span class="line">        console.log(&#39;[my-component] created&#39;)</span><br><span class="line">      &#125;,</span><br><span class="line">      attached: function () &#123; </span><br><span class="line">        console.log(&#39;[my-component] attached&#39;)</span><br><span class="line">      &#125;,</span><br><span class="line">      ready: function () &#123;</span><br><span class="line">        console.log(&#39;[my-component] ready&#39;)</span><br><span class="line">      &#125;,</span><br><span class="line">      methods: &#123;</span><br><span class="line">        myMethod: function () &#123;</span><br><span class="line">          console.log(&#39;[my-component] log by myMethod&#39;)</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  1.当事件触发时候.</span><br><span class="line">    1.[my-behavior] created</span><br><span class="line">    2.[my-component] created</span><br><span class="line">    3.[my-behavior] attached</span><br><span class="line">    4.[my-component] attached</span><br><span class="line">    5.[my-behavior] ready</span><br><span class="line">    6.[my-component] read</span><br><span class="line">  2.同名字段的覆盖和组合规则</span><br><span class="line">    1.如果有同名的属性 (properties) 或方法 (methods)</span><br><span class="line">        1.若组件本身有这个属性或方法，则组件的属性或方法会覆盖 behavior 中的同名属性或方法；</span><br><span class="line">        2.若组件本身无这个属性或方法，则在组件的 behaviors 字段中定义靠后的 behavior 的属性或方法会覆盖靠前的同名属性或方法；</span><br><span class="line">        3.在 2 的基础上，若存在嵌套引用 behavior 的情况，则规则为：父 behavior 覆盖 子 behavior 中的同名属性或方法。</span><br><span class="line">    2.如果有同名的数据字段 (data)：</span><br><span class="line">        1.若同名的数据字段都是对象类型，会进行对象合并；</span><br><span class="line">        2.其余情况会进行数据覆盖，覆盖规则为：组件 &gt; 父 behavior &gt; 子 behavior 、 靠后的 behavior &gt; 靠前的 behavior。（优先级高的覆盖优先级低的，最大的为优先级最高）</span><br><span class="line">    3.生命周期函数不会相互覆盖，而是在对应触发时机被逐个调用.</span><br><span class="line">        1.对于不同的生命周期函数之间，遵循组件生命周期函数的执行顺序；</span><br><span class="line">        2.对于同种生命周期函数，遵循如下规则：</span><br><span class="line">            behavior 优先于组件执行；</span><br><span class="line">            子 behavior 优先于 父 behavior 执行；</span><br><span class="line">            靠前的 behavior 优先于 靠后的 behavior 执行；</span><br><span class="line">        3.如果同一个 behavior 被一个组件多次引用，它定义的生命周期函数只会被执行一次</span><br><span class="line">4.内置behaviors.</span><br><span class="line">    1.自定义组件可以通过引用内置的 behavior 来获得内置组件的一些行为。</span><br><span class="line">       如:</span><br><span class="line">            Component(&#123;</span><br><span class="line">              behaviors: [&#39;wx:&#x2F;&#x2F;form-field&#39;]</span><br><span class="line">            &#125;)</span><br><span class="line">    2.behaviors.</span><br><span class="line">        wx:&#x2F;&#x2F;form-field 使自定义组件有类似于表单控件的行为</span><br><span class="line">        wx:&#x2F;&#x2F;form-field-group 使 form 组件可以识别到这个自定义组件内部的所有表单控件。</span><br><span class="line">        wx:&#x2F;&#x2F;form-field-button 使 form 组件可以识别到这个自定义组件内部的 button 。如果自定义组件内部有设置了 form-type 的 button ，它将被组件外的 form 接受。</span><br><span class="line">        wx:&#x2F;&#x2F;component-export 使自定义组件支持 export 定义段。这个定义段可以用于指定组件被 selectComponent 调用时的返回值。</span><br></pre></td></tr></table></figure>
<h3 id="组件间关系"><a href="#组件间关系" class="headerlink" title="组件间关系"></a>组件间关系</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">1.定义和使用组件间关系.</span><br><span class="line">    &lt;custom-ul&gt;</span><br><span class="line">      &lt;custom-li&gt; item 1 &lt;&#x2F;custom-li&gt;</span><br><span class="line">      &lt;custom-li&gt; item 2 &lt;&#x2F;custom-li&gt;</span><br><span class="line">    &lt;&#x2F;custom-ul&gt;</span><br><span class="line">  custom-ul 与 custom-li 是父子的关系.</span><br><span class="line">2.父子关系的组件,相互通信比较麻烦(class选择器很麻烦),在组件中加入relations字段解决这个问题.</span><br><span class="line">    &#x2F;&#x2F; path&#x2F;to&#x2F;custom-ul.js</span><br><span class="line">    Component(&#123;</span><br><span class="line">      relations: &#123;</span><br><span class="line">        &#39;.&#x2F;custom-li&#39;: &#123;</span><br><span class="line">          type: &#39;child&#39;, &#x2F;&#x2F; 关联的目标节点应为子节点</span><br><span class="line">          linked: function(target) &#123;</span><br><span class="line">            &#x2F;&#x2F; 每次有custom-li被插入时执行，target是该节点实例对象，触发在该节点attached生命周期之后</span><br><span class="line">          &#125;,</span><br><span class="line">          linkChanged: function(target) &#123;</span><br><span class="line">            &#x2F;&#x2F; 每次有custom-li被移动后执行，target是该节点实例对象，触发在该节点moved生命周期之后</span><br><span class="line">          &#125;,</span><br><span class="line">          unlinked: function(target) &#123;</span><br><span class="line">            &#x2F;&#x2F; 每次有custom-li被移除时执行，target是该节点实例对象，触发在该节点detached生命周期之后</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      methods: &#123;</span><br><span class="line">        _getAllLi: function()&#123;</span><br><span class="line">          &#x2F;&#x2F; 使用getRelationNodes可以获得nodes数组，包含所有已关联的custom-li，且是有序的</span><br><span class="line">          var nodes &#x3D; this.getRelationNodes(&#39;path&#x2F;to&#x2F;custom-li&#39;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      ready: function()&#123;</span><br><span class="line">        this._getAllLi()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; path&#x2F;to&#x2F;custom-li.js</span><br><span class="line">    Component(&#123;</span><br><span class="line">      relations: &#123;</span><br><span class="line">        &#39;.&#x2F;custom-ul&#39;: &#123;</span><br><span class="line">          type: &#39;parent&#39;, &#x2F;&#x2F; 关联的目标节点应为父节点</span><br><span class="line">          linked: function(target) &#123;</span><br><span class="line">            &#x2F;&#x2F; 每次被插入到custom-ul时执行，target是custom-ul节点实例对象，触发在attached生命周期之后</span><br><span class="line">          &#125;,</span><br><span class="line">          linkChanged: function(target) &#123;</span><br><span class="line">            &#x2F;&#x2F; 每次被移动后执行，target是custom-ul节点实例对象，触发在moved生命周期之后</span><br><span class="line">          &#125;,</span><br><span class="line">          unlinked: function(target) &#123;</span><br><span class="line">            &#x2F;&#x2F; 每次被移除时执行，target是custom-ul节点实例对象，触发在detached生命周期之后</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"> 注意：必须在两个组件定义中都加入relations定义，否则不会生效</span><br><span class="line">3.关联一类</span><br><span class="line">  如 form 关联 ul,li,input,button等.</span><br><span class="line">  &#x2F;&#x2F;custom-form</span><br><span class="line">  &lt;custom-form&gt;</span><br><span class="line">    &lt;view&gt;</span><br><span class="line">      input</span><br><span class="line">      &lt;custom-input&gt;&lt;&#x2F;custom-input&gt;</span><br><span class="line">    &lt;&#x2F;view&gt;</span><br><span class="line">    &lt;custom-submit&gt; submit &lt;&#x2F;custom-submit&gt;</span><br><span class="line">  &lt;&#x2F;custom-form&gt;</span><br><span class="line">     </span><br><span class="line">     &#x2F;&#x2F; path&#x2F;to&#x2F;custom-form-controls.js</span><br><span class="line">     module.exports &#x3D; Behavior(&#123;</span><br><span class="line">       &#x2F;&#x2F; ...</span><br><span class="line">     &#125;)</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; path&#x2F;to&#x2F;custom-form.js</span><br><span class="line">    var customFormControls &#x3D; require(&#39;.&#x2F;custom-form-controls&#39;)</span><br><span class="line">    Component(&#123;</span><br><span class="line">      relations: &#123;</span><br><span class="line">        &#39;customFormControls&#39;: &#123;</span><br><span class="line">          type: &#39;descendant&#39;, &#x2F;&#x2F; 关联的目标节点应为子孙节点</span><br><span class="line">          target: customFormControls</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)     </span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; path&#x2F;to&#x2F;custom-input.js</span><br><span class="line">    var customFormControls &#x3D; require(&#39;.&#x2F;custom-form-controls&#39;)</span><br><span class="line">    Component(&#123;</span><br><span class="line">      behaviors: [customFormControls],</span><br><span class="line">      relations: &#123;</span><br><span class="line">        &#39;.&#x2F;custom-form&#39;: &#123;</span><br><span class="line">          type: &#39;ancestor&#39;, &#x2F;&#x2F; 关联的目标节点应为祖先节点</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    var customFormControls &#x3D; require(&#39;.&#x2F;custom-form-controls&#39;)</span><br><span class="line">    Component(&#123;</span><br><span class="line">      behaviors: [customFormControls],</span><br><span class="line">      relations: &#123;</span><br><span class="line">        &#39;.&#x2F;custom-form&#39;: &#123;</span><br><span class="line">          type: &#39;ancestor&#39;, &#x2F;&#x2F; 关联的目标节点应为祖先节点</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>
<h3 id="数据监听器"><a href="#数据监听器" class="headerlink" title="数据监听器"></a>数据监听器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">1.数据监听器可以用于监听和响应任何属性和数据字段的变化。</span><br><span class="line">2.举个例子:</span><br><span class="line">  this.data.sum &#x3D; this.data.number1 + this.data.number2;</span><br><span class="line">    Component(&#123;</span><br><span class="line">      attached: function() &#123;</span><br><span class="line">        this.setData(&#123;</span><br><span class="line">          numberA: 1,</span><br><span class="line">          numberB: 2,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      observers: &#123;</span><br><span class="line">        &#39;numberA, numberB&#39;: function(numberA, numberB) &#123;</span><br><span class="line">          &#x2F;&#x2F; 在 numberA 或者 numberB 被设置时，执行这个函数</span><br><span class="line">          this.setData(&#123;</span><br><span class="line">            sum: numberA + numberB</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">3.数据监听器支持监听属性或内部数据的变化，可以同时监听多个。同时，监听器可以监听子数据字段，如下例所示。</span><br><span class="line">    Component(&#123;</span><br><span class="line">      observers: &#123;</span><br><span class="line">        &#39;some.subfield&#39;: function(subfield) &#123;</span><br><span class="line">          &#x2F;&#x2F; 使用 setData 设置 this.data.some.subfield 时触发</span><br><span class="line">          &#x2F;&#x2F; （除此以外，使用 setData 设置 this.data.some 也会触发）</span><br><span class="line">          subfield &#x3D;&#x3D;&#x3D; this.data.some.subfield</span><br><span class="line">        &#125;,</span><br><span class="line">        &#39;arr[12]&#39;: function(arr12) &#123;</span><br><span class="line">          &#x2F;&#x2F; 使用 setData 设置 this.data.arr[12] 时触发</span><br><span class="line">          &#x2F;&#x2F; （除此以外，使用 setData 设置 this.data.arr 也会触发）</span><br><span class="line">          arr12 &#x3D;&#x3D;&#x3D; this.data.arr[12]</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">4.使用**可以监听所有的data字段.</span><br></pre></td></tr></table></figure>
<h3 id="纯数据字段"><a href="#纯数据字段" class="headerlink" title="纯数据字段"></a>纯数据字段</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">1.纯数据字段是一些不用于界面渲染的 data 字段，可以用于提升页面更新性能。从小程序基础库版本 2.8.2 开始支持。</span><br><span class="line">2.纯数据字段”的方法是在 Component 构造器的 options 定义段中指定 pureDataPattern 为一个正则表达式，字段名符合这个正则表达式的字段将成为纯数据字段。</span><br><span class="line">如:</span><br><span class="line">    Component(&#123;</span><br><span class="line">      options: &#123;</span><br><span class="line">        pureDataPattern: &#x2F;^_&#x2F; &#x2F;&#x2F; 指定所有 _ 开头的数据字段为纯数据字段</span><br><span class="line">      &#125;,</span><br><span class="line">      data: &#123;</span><br><span class="line">        a: true, &#x2F;&#x2F; 普通数据字段</span><br><span class="line">        _b: true, &#x2F;&#x2F; 纯数据字段</span><br><span class="line">      &#125;,</span><br><span class="line">      methods: &#123;</span><br><span class="line">        myMethod() &#123;</span><br><span class="line">          this.data._b &#x2F;&#x2F; 纯数据字段可以在 this.data 中获取</span><br><span class="line">          this.setData(&#123;</span><br><span class="line">            c: true, &#x2F;&#x2F; 普通数据字段</span><br><span class="line">            _d: true, &#x2F;&#x2F; 纯数据字段</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    &lt;view wx:if&#x3D;&quot;&#123;&#123;a&#125;&#125;&quot;&gt; 这行会被展示 &lt;&#x2F;view&gt;</span><br><span class="line">    &lt;view wx:if&#x3D;&quot;&#123;&#123;_b&#125;&#125;&quot;&gt; 这行不会被展示 &lt;&#x2F;view&gt;</span><br><span class="line">3.组件属性中的纯数据字段.</span><br><span class="line">  属性中的纯数据字段可以像普通属性一样接收外部传入的属性值，但不能将它直接用于组件自身的 WXML 中。</span><br><span class="line">  Component(&#123;</span><br><span class="line">    options: &#123;</span><br><span class="line">      pureDataPattern: &#x2F;^_&#x2F;</span><br><span class="line">    &#125;,</span><br><span class="line">    properties: &#123;</span><br><span class="line">      a: Boolean,</span><br><span class="line">      _b: &#123;</span><br><span class="line">        type: Boolean,</span><br><span class="line">        observer() &#123;</span><br><span class="line">          &#x2F;&#x2F; 不要这样做！这个 observer 永远不会被触发</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">4.使用数据监听器监听纯数据字段.</span><br><span class="line">    Component(&#123;</span><br><span class="line">      options: &#123;</span><br><span class="line">        pureDataPattern: &#x2F;^timestamp$&#x2F; &#x2F;&#x2F; 将 timestamp 属性指定为纯数据字段</span><br><span class="line">      &#125;,</span><br><span class="line">      properties: &#123;</span><br><span class="line">        timestamp: Number,</span><br><span class="line">      &#125;,</span><br><span class="line">      observers: &#123;</span><br><span class="line">        timestamp: function () &#123;</span><br><span class="line">          &#x2F;&#x2F; timestamp 被设置时，将它展示为可读时间字符串</span><br><span class="line">          var timeString &#x3D; new Date(this.data.timestamp).toLocaleString()</span><br><span class="line">          this.setData(&#123;</span><br><span class="line">            timeString: timeString</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    &lt;view&gt;&#123;&#123;timeString&#125;&#125;&lt;&#x2F;view&gt;</span><br></pre></td></tr></table></figure>
<h3 id="抽象节点"><a href="#抽象节点" class="headerlink" title="抽象节点"></a>抽象节点</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">1.有时，自定义组件模板中的一些节点，其对应的自定义组件不是由自定义组件本身确定的，而是自定义组件的调用者确定的。这时可以把这个节点声明为“抽象节点”。</span><br><span class="line">2.例如:我们现在来实现一个“选框组”（selectable-group）组件，它其中可以放置单选框（custom-radio）或者复选框（custom-checkbox）。这个组件的 wxml 可以这样编写：</span><br><span class="line">&lt;!-- selectable-group.wxml --&gt;</span><br><span class="line">&lt;view wx:for&#x3D;&quot;&#123;&#123;labels&#125;&#125;&quot;&gt;</span><br><span class="line">  &lt;label&gt;</span><br><span class="line">    &#x2F;&#x2F;可单可复选框</span><br><span class="line">    &lt;selectable disabled&#x3D;&quot;&#123;&#123;false&#125;&#125;&quot;&gt;&lt;&#x2F;selectable&gt;</span><br><span class="line">    &#123;&#123;item&#125;&#125;</span><br><span class="line">  &lt;&#x2F;label&gt;</span><br><span class="line">&lt;&#x2F;view&gt;</span><br><span class="line">&#x2F;&#x2F;component对应json</span><br><span class="line">&#123;</span><br><span class="line">  &quot;componentGenerics&quot;: &#123;</span><br><span class="line">    &quot;selectable&quot;: true</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">3.使用包含抽象节点的组件</span><br><span class="line">    &lt;selectable-group generic:selectable&#x3D;&quot;custom-radio&quot; &#x2F;&gt;</span><br><span class="line">    或</span><br><span class="line">    &lt;selectable-group generic:selectable&#x3D;&quot;custom-checkbox&quot; &#x2F;&gt;</span><br><span class="line">4.page对应的json</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;usingComponents&quot;: &#123;</span><br><span class="line">        &quot;custom-radio&quot;: &quot;path&#x2F;to&#x2F;custom&#x2F;radio&quot;,</span><br><span class="line">        &quot;custom-checkbox&quot;: &quot;path&#x2F;to&#x2F;custom&#x2F;checkbox&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">5.抽象节点默认节点.</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;componentGenerics&quot;: &#123;</span><br><span class="line">        &quot;selectable&quot;: &#123;</span><br><span class="line">          &quot;default&quot;: &quot;path&#x2F;to&#x2F;default&#x2F;component&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

    </div>

    
    
    
		<div>
			
				<div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>

			
		</div>

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/mini-program/" rel="tag"># mini-program</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/06/23/algorithm-geek/" rel="prev" title="algorithm-geek">
      <i class="fa fa-chevron-left"></i> algorithm-geek
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/07/11/jvm/" rel="next" title="jvm">
      jvm <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    <div class="comments" id="comments"></div>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#起步"><span class="nav-number">1.</span> <span class="nav-text">起步</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#代码构成"><span class="nav-number">1.1.</span> <span class="nav-text">代码构成</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#json"><span class="nav-number">1.2.</span> <span class="nav-text">json</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#app-json"><span class="nav-number">1.2.1.</span> <span class="nav-text">app.json</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#project-config-json"><span class="nav-number">1.2.2.</span> <span class="nav-text">project.config.json</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WXML模板"><span class="nav-number">1.3.</span> <span class="nav-text">WXML模板</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WXSS样式"><span class="nav-number">1.4.</span> <span class="nav-text">WXSS样式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#app-wxss"><span class="nav-number">1.4.1.</span> <span class="nav-text">app.wxss</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JS逻辑交互"><span class="nav-number">1.5.</span> <span class="nav-text">JS逻辑交互</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#小程序宿主环境"><span class="nav-number">1.6.</span> <span class="nav-text">小程序宿主环境</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#渲染层与逻辑层"><span class="nav-number">1.6.1.</span> <span class="nav-text">渲染层与逻辑层</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置小程序"><span class="nav-number">2.</span> <span class="nav-text">配置小程序</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#全局配置"><span class="nav-number">2.1.</span> <span class="nav-text">全局配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sitemap配置"><span class="nav-number">2.2.</span> <span class="nav-text">sitemap配置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#小程序框架"><span class="nav-number">3.</span> <span class="nav-text">小程序框架</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#场景值"><span class="nav-number">3.1.</span> <span class="nav-text">场景值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#逻辑层-App-Service"><span class="nav-number">3.2.</span> <span class="nav-text">逻辑层 App Service</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#注册小程序"><span class="nav-number">3.2.1.</span> <span class="nav-text">注册小程序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#注册页面"><span class="nav-number">3.2.2.</span> <span class="nav-text">注册页面</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#页面生命周期"><span class="nav-number">3.2.3.</span> <span class="nav-text">页面生命周期</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#页面路由"><span class="nav-number">3.3.</span> <span class="nav-text">页面路由</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#页面栈"><span class="nav-number">3.3.1.</span> <span class="nav-text">页面栈</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#路由方式"><span class="nav-number">3.3.2.</span> <span class="nav-text">路由方式</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#模块化"><span class="nav-number">3.4.</span> <span class="nav-text">模块化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#文件作用域"><span class="nav-number">3.4.1.</span> <span class="nav-text">文件作用域</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#API"><span class="nav-number">3.5.</span> <span class="nav-text">API</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#事件监听API"><span class="nav-number">3.5.1.</span> <span class="nav-text">事件监听API</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#同步API"><span class="nav-number">3.5.2.</span> <span class="nav-text">同步API</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#异步API"><span class="nav-number">3.5.3.</span> <span class="nav-text">异步API</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#异步API返回Promise"><span class="nav-number">3.5.4.</span> <span class="nav-text">异步API返回Promise</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#视图层"><span class="nav-number">3.6.</span> <span class="nav-text">视图层</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#wxml"><span class="nav-number">3.6.1.</span> <span class="nav-text">wxml</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WXSS"><span class="nav-number">3.7.</span> <span class="nav-text">WXSS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#事件"><span class="nav-number">3.8.</span> <span class="nav-text">事件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#基础组件"><span class="nav-number">3.9.</span> <span class="nav-text">基础组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获取界面上的节点信息"><span class="nav-number">3.10.</span> <span class="nav-text">获取界面上的节点信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#初始渲染缓存"><span class="nav-number">3.11.</span> <span class="nav-text">初始渲染缓存</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#自定义组件"><span class="nav-number">4.</span> <span class="nav-text">自定义组件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#简单使用"><span class="nav-number">4.1.</span> <span class="nav-text">简单使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#组件模板和样式"><span class="nav-number">4.2.</span> <span class="nav-text">组件模板和样式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Component-构造器"><span class="nav-number">4.3.</span> <span class="nav-text">Component 构造器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#组件间通信和事件"><span class="nav-number">4.4.</span> <span class="nav-text">组件间通信和事件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#组件生命周期"><span class="nav-number">4.5.</span> <span class="nav-text">组件生命周期</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#behaviors"><span class="nav-number">4.6.</span> <span class="nav-text">behaviors</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#组件间关系"><span class="nav-number">4.7.</span> <span class="nav-text">组件间关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据监听器"><span class="nav-number">4.8.</span> <span class="nav-text">数据监听器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#纯数据字段"><span class="nav-number">4.9.</span> <span class="nav-text">纯数据字段</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#抽象节点"><span class="nav-number">4.10.</span> <span class="nav-text">抽象节点</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="vicyor"
      src="/images/head.png">
  <p class="site-author-name" itemprop="name">vicyor</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">55</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">49</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/vicyor" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;vicyor" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:2457569580@qq.com" title="E-Mail → mailto:2457569580@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">vicyor</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">885k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">13:25</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.2.1
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.6.0
  </div>

        






  <script>
  function leancloudSelector(url) {
    return document.getElementById(url).querySelector('.leancloud-visitors-count');
  }
  if (CONFIG.page.isPost) {
    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = visitors.getAttribute('id').trim();
      var title = visitors.getAttribute('data-flag-title').trim();

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .then(response => response.json())
              .then(() => {
                leancloudSelector(url).innerText = counter.time + 1;
              })
              .catch(error => {
                console.log('Failed to save visitor count', error);
              })
          } else {
              Counter('post', '/classes/Counter', { title: title, url: url, time: 1 })
                .then(response => response.json())
                .then(() => {
                  leancloudSelector(url).innerText = 1;
                })
                .catch(error => {
                  console.log('Failed to create', error);
                });
          }
        })
        .catch(error => {
          console.log('LeanCloud Counter Error', error);
        });
    }
  } else {
    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return element.getAttribute('id').trim();
      });

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url: { '$in': entries } })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length === 0) {
            document.querySelectorAll('.leancloud_visitors .leancloud-visitors-count').forEach(element => {
              element.innerText = 0;
            });
            return;
          }
          for (let item of results) {
            let { url, time } = item;
            leancloudSelector(url).innerText = time;
          }
          for (let url of entries) {
            var element = leancloudSelector(url);
            if (element.innerText == '') {
              element.innerText = 0;
            }
          }
        })
        .catch(error => {
          console.log('LeanCloud Counter Error', error);
        });
    }
  }

  fetch('https://app-router.leancloud.cn/2/route?appId=m9GqFbk5NEr9mLiLAXCyheul-gzGzoHsz')
    .then(response => response.json())
    .then(({ api_server }) => {
      var Counter = (method, url, data) => {
        return fetch(`https://${api_server}/1.1${url}`, {
          method: method,
          headers: {
            'X-LC-Id': 'm9GqFbk5NEr9mLiLAXCyheul-gzGzoHsz',
            'X-LC-Key': 'g7WSuE6aDmunoX4rgyBN7SJa',
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    });
  </script>


      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  


<script>
NexT.utils.getScript('//cdnjs.cloudflare.com/ajax/libs/valine/1.3.10/Valine.min.js', () => {
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(item => {
    return GUEST.includes(item);
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: false,
    appId: 'qQhr9rNGJh6YalJA0mfaaurx-gzGzoHsz',
    appKey: 'kJy8NJeOTMPnxQ3zLihOcnw3',
    placeholder: "请留下您的宝贵评论",
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: false,
    lang: '' || 'zh-cn',
    path: location.pathname,
    recordIP: false,
    serverURLs: ''
  });
}, window.Valine);
</script>

	
		 <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas> 
		 <script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script> 
		 <script type="text/javascript" src="/js/src/fireworks.js"></script>
	
</body>
</html>
